<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StandardBank Caller - Show Passwords</title>

    <!-- Add bootstrap 5 and fontawesome -->

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />

    <link rel="stylesheet" href="../../assets/css/global.css" />
  </head>
  <style>
    * {
      margin: 0 !important;
      padding: 0 !important;
      box-sizing: border-box !important;
    }
  </style>
  <body style="height: 100vh">
    <main class="row h-100">
      <div class="col d-flex flex-column">
        <div
          id="carouselExampleCaptions"
          class="carousel slide flex-grow-1"
          data-bs-ride="carousel"
        >
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img
                src="../../assets/img/2rendi_Landscape_lw_h-100.jpg"
                class="d-block w-100 h-100"
                alt="..."
              />
              <div class="carousel-caption d-none d-md-block">
                <h5>Standard Obrigações e Standard Tesouraria</h5>
                <p>
                  "Agora pode investir no seu futuro com os Fundos Abertos da
                  Standard Gestão de Activos, o Standard Obrigações e Standard
                  Tesouraria."
                </p>
              </div>
            </div>

            <div class="carousel-item">
              <img
                src="../../assets/img/best-bank.jpg"
                class="d-block w-100"
                alt="..."
              />
              <div class="carousel-caption d-none d-md-block">
                <h5>The Banker: Melhor Banco do Ano em Angola</h5>
                <p>
                  " Vencemos o prémio Banco do Ano em Angola 2023 atribuído pela
                  prestigiada publicação financeira The Banker (Grupo Financial
                  Times)"
                </p>
              </div>
            </div>
          </div>
        </div>
        <div
          class="p-3 text-white"
          style="
            background: linear-gradient(151deg, #0033aa 0%, #0a2240 100%)
              no-repeat;
          "
        >
          <marquee>
            <p>
              13:30 - Disponibilizamos-lhe uma vasta gama de soluções que fazem
              você gastar menos tempo no Banco e mais tempo com a sua vida.
            </p>
          </marquee>
        </div>
      </div>

      <div
        class="col-4 d-flex flex-column"
        style="
          background: linear-gradient(151deg, #0033aa 0%, #0a2240 100%)
            no-repeat;
        "
      >
        <div
          class="d-flex flex-column justify-content-center align-items-center"
        >
          <img
            src="../../assets/img/pngegg.png"
            alt="Logo"
            width="200"
            class="d-inline-block align-text-top"
            style="mix-blend-mode: color-dodge; filter: invert(1)"
          />
          <h4 class="text-light mb-3">Standard Bank Caller</h4>
        </div>

        <div class="row gap-3 w-100 justify-content-center p-4 flex-grow-1">
          <button
            class="btn btn-primary d-flex col-12 align-items-center rounded-pill btn-service"
            id="1"
            style="height: 65px"
          >
            <span
              class="rounded rounded-circle border border-2 d-flex align-items-center justify-content-center balcon"
              style="width: 65px; height: 65px"
              >1</span
            >
            <div class="flex-grow-1 d-flex flex-column detail">
              <span class="" style="font-size: smaller">Atendimento geral</span>
              <strong class="h1">A001</strong>
            </div>
          </button>
          <button
            class="btn btn-primary d-flex col-12 align-items-center enabled rounded-pill btn-service"
            id="2"
            style="height: 65px"
          >
            <span
              class="rounded rounded-circle border border-2 d-flex align-items-center justify-content-center balcon"
              style="width: 65px; height: 65px"
              >2</span
            >
            <div class="flex-grow-1 d-flex flex-column detail">
              <span class="" style="font-size: smaller">Depósito</span>
              <strong class="h1">B001</strong>
            </div>
          </button>
          <button
            class="btn btn-primary d-flex col-12 align-items-center rounded-pill btn-service"
            id="3"
            style="height: 65px"
          >
            <span
              class="rounded rounded-circle border border-2 d-flex align-items-center justify-content-center balcon"
              style="width: 65px; height: 65px"
              >3</span
            >
            <div class="flex-grow-1 d-flex flex-column detail">
              <span class="" style="font-size: smaller">Abertura de Conta</span>
              <strong class="h1">C001</strong>
            </div>
          </button>
          <button
            class="btn btn-primary d-flex col-12 align-items-center rounded-pill btn-service"
            id="4"
            style="height: 65px"
          >
            <span
              class="rounded rounded-circle border border-2 d-flex align-items-center justify-content-center balcon"
              style="width: 65px; height: 65px"
              >4</span
            >
            <div class="flex-grow-1 d-flex flex-column detail">
              <span class="" style="font-size: smaller">Internet Banking</span>
              <strong class="h1">D001</strong>
            </div>
          </button>
        </div>
        <hr class="border-white" />
        <div
          class="d-flex align-items-center justify-content-between px-5 py-3 text-white"
        >
          <strong>Sexta. 18 AGO 2022</strong>
          <strong class="h4">14:32</strong>
        </div>
      </div>
    </main>

    <script>
      var speaks = [
        {
          name: "Clarinha",
          lang: "pt-BR",
        },
      ];
      var serviceList = [];
      let service = -1;
      let counterServicesObject = {
        password1Id: 0,
        password2Id: 0,
        password3Id: 0,
        password4Id: 0,
      };

      const servicesButtons = document.querySelectorAll(".btn-service");

      var timer = setInterval(function () {
        getCurrentCallFromStorage();
        getServiceListFromStorage();
        if (verifyItem()) {
          console.log("passou");
        }
      }, 1000);

      // Function to retrieve currentCall from the Storage object
      function getCurrentCallFromStorage() {
        let currentCallJson = localStorage.getItem("currentCall");
        if (currentCallJson) {
          currentCall = JSON.parse(currentCallJson);
        }
      }

      // Function to retrieve currentCall from the Storage object
      function getServiceListFromStorage() {
        let serviceListJson = localStorage.getItem("serviceList");
        if (serviceListJson) {
          serviceList = JSON.parse(serviceListJson);
        }
      }

      function getServiceLetterById(id) {
        switch (parseInt(id)) {
          case 1:
            return "A";
          case 2:
            return "B";
          case 3:
            return "C";
          case 4:
            return "D";
          default:
            return "";
        }
      }

      function formatMessageToSpeech(item) {
        switch (parseInt(item.serviceId)) {
          case 1:
            return `Serviço ${getServiceLetterById(item.serviceId)}, Senha ${
              counterServicesObject.password1Id
            }, Balcão ${item.balconId}!`;
          case 2:
            return `Serviço ${getServiceLetterById(item.serviceId)}, Senha ${
              counterServicesObject.password2Id
            }, Balcão ${item.balconId}!`;
          case 3:
            return `Serviço ${getServiceLetterById(item.serviceId)}, Senha ${
              counterServicesObject.password3Id
            }, Balcão ${item.balconId}!`;
          case 4:
            return `Serviço ${getServiceLetterById(item.serviceId)}, Senha ${
              counterServicesObject.password4Id
            }, Balcão ${item.balconId}!`;
          default:
            return "";
        }
      }

      function verifyItem() {
        if (currentCall.serviceId !== -1 && currentCall.balconId !== -1) {
          const item = serviceList.find(
            (x) => x.serviceId === parseInt(currentCall.serviceId)
          );

          if (item) {
            verifyPasswordId(currentCall.serviceId);

            const msg = new SpeechSynthesisUtterance();
            msg.volume = 1; //define o volume do áudio (de 0 a 1)
            msg.rate = 0.8; // define a velocidade do áudio (0.1 a 1)
            msg.pitch = 1; // define o tom em que o áudio é falado (de 0 a 2)
            msg.text = formatMessageToSpeech(currentCall); //Pega o valor do input e passa para o objeto sintetizar

            const voice = speaks[0]; //pegamos o objeto que queremos que seja a nossa fala. [0], pois nosso array speaks só possui uma posição, que é a que queremos (Clarinha pt-BR)
            voice.voiceURI = voice.name; //voiceURI busca o servidor da voz escolhida, no caso, pt-BR defnido em voice.name
            msg.lang = voice.lang; // Define o idioma a ser utilizado para a fala, no caso, o que foi definido para voice.lang

            speechSynthesis.speak(msg); //executa a voz
            currentCall = null;
            localStorage.removeItem("currentCall");
            return true;
          } else {
            alert("Chamada não encontrada!");
            return false;
          }
        } else {
          return false;
        }

        currentCall = null;
      }

      function setData(serviceId) {
        servicesButtons.forEach((button, index) => {
          let service = button.id;
          let findItem = serviceList.find(
            (item) => item.serviceId === serviceId
          );
          if (findItem) {
            button.querySelector(".balcon").innerHTML = findItem.balconId;
            button.querySelector(".detail strong").innerHTML =
              formatPasswordByService(findItem);
          }
        });
      }

      function formatPasswordByService(item) {
        switch (parseInt(item.serviceId)) {
          case 1:
            return `A${
              item.password < 10
                ? `00${item.password}`
                : item.password > 10 && item.password < 100
                ? `0${item.password}`
                : item.password
            }`;
          case 2:
            return `B${
              item.password < 10
                ? `00${item.password}`
                : item.password > 10 && item.password < 100
                ? `0${item.password}`
                : item.password
            }`;
          case 3:
            return `C${
              item.password < 10
                ? `00${item.password}`
                : item.password > 10 && item.password < 100
                ? `0${item.password}`
                : item.password
            }`;
          case 4:
            return `D${
              item.password < 10
                ? `00${item.password}`
                : item.password > 10 && item.password < 100
                ? `0${item.password}`
                : item.password
            }`;
          default:
            return "";
        }
      }
      function getTotalServiceByid(serviceId) {
        var total = 0;
        serviceList.forEach((service) => {
          if (service.serviceId === parseInt(serviceId)) {
            total++;
          }
        });
        return total;
      }
      function verifyPasswordId(serviceId) {
        switch (parseInt(serviceId)) {
          case 1:
            counterServicesObject.password1Id =
              counterServicesObject.password1Id &&
              counterServicesObject.password1Id < getTotalServiceByid(1)
                ? counterServicesObject.password1Id + 1
                : 1;
            setData(serviceId);
            break;
          case 2:
            counterServicesObject.password2Id =
              counterServicesObject.password2Id &&
              counterServicesObject.password2Id < getTotalServiceByid(2)
                ? counterServicesObject.password2Id + 1
                : 1;
            setData(serviceId);
            break;
          case 3:
            counterServicesObject.password3Id =
              counterServicesObject.password3Id &&
              counterServicesObject.password3Id < getTotalServiceByid(3)
                ? counterServicesObject.password3Id + 1
                : 1;
            setData(serviceId);
            break;
          case 4:
            counterServicesObject.password4Id =
              counterServicesObject.password4Id &&
              counterServicesObject.password4Id < getTotalServiceByid(4)
                ? counterServicesObject.password4Id + 1
                : 1;
            setData(serviceId);
            break;
          default:
            break;
        }
      }
    </script>
  </body>
</html>
