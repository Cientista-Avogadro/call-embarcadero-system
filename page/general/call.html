<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StandardBank Caller - Call Password</title>

    <!-- Add bootstrap 5 and fontawesome -->

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />

    <link rel="stylesheet" href="../../assets/css/global.css" />
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg sticky-top"
      style="background: linear-gradient(151deg, #0033aa 0%, #0a2240 100%)"
    >
      <div class="container-fluid">
        <a class="navbar-brand text-white" href="#">
          <img
            src="../../assets/img/pngegg.png"
            alt="Logo"
            width="150"
            class="d-inline-block align-text-top"
            style="mix-blend-mode: color-dodge; filter: invert(1)"
          />
        </a>
        <button
          class="navbar-toggler text-bg-primary"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarScroll"
          aria-controls="navbarScroll"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarScroll">
          <ul
            class="navbar-nav my-2 my-lg-0 navbar-nav-scroll"
            style="--bs-scroll-height: 100px"
          >
            <li class="nav-item">
              <a class="nav-link active text-white" aria-current="page" href="#"
                >Home</a
              >
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle text-white"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Definições
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="#">Serviços e Sub-Serviços</a>
                </li>
                <li><a class="dropdown-item" href="#">Senhas</a></li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#">Usuário</a>
                </li>
              </ul>
            </li>
          </ul>
          <div class="mx-auto">
            <strong
              class="btn btn-outline-light px-5 curPass"
              style="font-size: 2rem"
              >A001</strong
            >
          </div>
          <div class="button-group float-end">
            <button id="btnSpeak" class="btn btn-primary" type="button">
              Chamar
            </button>
            <button id="btnFinish" class="btn btn-success" type="button">
              Atendido
            </button>
          </div>
        </div>
      </div>
    </nav>

    <main class="container">
      <div class="row">
        <div class="col-5">
          <h1 class="text-center w-100">Serviços</h1>
          <hr />
          <div class="d-flex flex-wrap gap-3">
            <button
              class="btn btn-primary btn-block rounded-pill btn-service"
              id="1"
            >
              Atendimento geral
            </button>
            <button
              class="btn btn-primary btn-block rounded-pill btn-service"
              id="2"
            >
              Depósito
            </button>
            <button
              class="btn btn-primary btn-block rounded-pill btn-service"
              id="3"
            >
              Abertura de Conta
            </button>
            <button
              class="btn btn-primary btn-block rounded-pill btn-service"
              id="4"
            >
              Atualização dos Dados
            </button>
          </div>
        </div>
        <div class="bg-dark rounded p-0" style="width: 4px !important"></div>
        <div class="col">
          <h1 class="text-center w-100">Balcão</h1>
          <hr />

          <div
            class="d-flex flex-wrap p-2 gap-4 justify-content-center"
            style="overflow-y: auto; max-height: calc(100% / 1.5)"
          >
            <button
              class="btn rounded-4 btn-balcon align-items-center d-flex flex-column"
              id="1"
            >
              <span class="fw-bold text-primary">1</span>
              <img
                src="../../assets/img/Consulting-amico.png"
                class="img-fluid"
                width="120"
                alt="balcon-icon"
              />
            </button>
            <button
              class="btn rounded-4 btn-balcon align-items-center d-flex flex-column"
              id="2"
            >
              <span class="fw-bold text-secondary">2</span>
              <img
                src="../../assets/img/Consulting-amico.png"
                class="img-fluid"
                width="120"
                alt="balcon-icon"
              />
            </button>
            <button
              class="btn rounded-4 btn-balcon align-items-center d-flex flex-column"
              id="3"
            >
              <span class="fw-bold text-secondary">3</span>
              <img
                src="../../assets/img/Consulting-amico.png"
                class="img-fluid"
                width="120"
                alt="balcon-icon"
              />
            </button>
            <button
              class="btn rounded-4 btn-balcon align-items-center d-flex flex-column"
              id="4"
            >
              <span class="fw-bold text-secondary">4</span>
              <img
                src="../../assets/img/Consulting-amico.png"
                class="img-fluid"
                width="120"
                alt="balcon-icon"
              />
            </button>
          </div>
        </div>
      </div>
    </main>

    <script>
      let currentCall = {
        serviceId: -1,
        balconId: -1,
      };
      var serviceList = [];
      let counterServicesObject = {
        password1Id: 0,
        password2Id: 0,
        password3Id: 0,
        password4Id: 0,
      };

      // Function to handle button clicks on services and balcon
      function handleButtonServiceClick() {
        let serviceId = this.id;
        currentCall.serviceId = serviceId;

        this.classList.toggle("active");
        // remove enabled classes from old buttons
        servicesButtons.forEach((button) => {
          if (button.id !== serviceId) {
            button.classList.remove("active");
          }
        });
      }

      const servicesButtons = document.querySelectorAll(".btn-service");
      servicesButtons.forEach((button) => {
        button.addEventListener("click", handleButtonServiceClick);
      });

      // Function to handle button click on balcon
      function handleButtonBalconClick() {
        let balconId = this.id;
        currentCall.balconId = balconId;

        this.classList.toggle("active");
        this.classList.toggle("border-primary");
        // remove enabled classes from old buttons
        balconButtons.forEach((button) => {
          if (button.id !== balconId) {
            button.classList.remove("active");
            button.classList.remove("border-primary");
          }
        });
      }

      const balconButtons = document.querySelectorAll(".btn-balcon");
      balconButtons.forEach((button) => {
        button.addEventListener("click", handleButtonBalconClick);
      });

      var timer = setInterval(function () {
        getServiceListFromStorage();

        if (currentCall.serviceId !== -1 && currentCall.balconId !== -1) {
          // disable atendido button
          document.getElementById("btnFinish").disabled = true;
        } else {
          // enable atendido button
          document.getElementById("btnFinish").disabled = false;
        }
      }, 1000);

      // Add currentCall to the Storage object if property is not -1 function
      function addCurrentCallToStorage() {
        if (currentCall.serviceId !== -1 && currentCall.balconId !== -1) {
          verifyPasswordId(currentCall.serviceId);
          localStorage.setItem("currentCall", JSON.stringify(currentCall));
          localStorage.setItem(
            "counterServicesObject",
            JSON.stringify(counterServicesObject)
          );
        }
      }

      // Function to retrieve currentCall from the Storage object
      function getCurrentCallFromStorage() {
        let currentCallJson = localStorage.getItem("currentCall");
        if (currentCallJson) {
          currentCall = JSON.parse(currentCallJson);
        }
      }

      // Function to retrieve currentCall from the Storage object
      function getServiceListFromStorage() {
        let serviceListJson = localStorage.getItem("serviceList");
        if (serviceListJson) {
          serviceList = JSON.parse(serviceListJson);
        }
      }
      function formatPassword(serviceId) {
        switch (parseInt(serviceId)) {
          case 1:
            return `${
              counterServicesObject.password1Id < 10
                ? `00${counterServicesObject.password1Id}`
                : counterServicesObject.password1Id > 10 &&
                  counterServicesObject.password1Id < 100
                ? `0${counterServicesObject.password1Id}`
                : counterServicesObject.password1Id
            }`;
          case 2:
            return `${
              counterServicesObject.password2Id < 10
                ? `00${counterServicesObject.password2Id}`
                : counterServicesObject.password2Id > 10 &&
                  counterServicesObject.password2Id < 100
                ? `0${counterServicesObject.password2Id}`
                : counterServicesObject.password2Id
            }`;
          case 3:
            return `${
              counterServicesObject.password3Id < 10
                ? `00${counterServicesObject.password3Id}`
                : counterServicesObject.password3Id > 10 &&
                  counterServicesObject.password3Id < 100
                ? `0${counterServicesObject.password3Id}`
                : counterServicesObject.password3Id
            }`;
          case 4:
            return `${
              counterServicesObject.password4Id < 10
                ? `00${counterServicesObject.password4Id}`
                : counterServicesObject.password4Id > 10 &&
                  counterServicesObject.password4Id < 100
                ? `0${counterServicesObject.password4Id}`
                : counterServicesObject.password4Id
            }`;
          default:
            return "";
        }
      }

      // Function to handle button click on Chamar
      document
        .getElementById("btnSpeak")
        .addEventListener("click", function () {
          verifyPasswordId(currentCall.serviceId);
          addCurrentCallToStorage();
        });

      // Function to handle button click on Atendido
      document
        .getElementById("btnFinish")
        .addEventListener("click", function () {
          currentCall.serviceId = -1;
          currentCall.balconId = -1;
          addCurrentCallToStorage();
        });

      function getTotalServiceByid(serviceId) {
        var total = 0;
        serviceList.forEach((service) => {
          if (service.serviceId === parseInt(serviceId)) {
            total++;
          }
        });
        return total;
      }

      function setData(serviceId) {
        document.querySelector(".curPass").innerHTML =
          getServiceLetterById(serviceId) + formatPassword(serviceId);
      }

      function getServiceLetterById(id) {
        switch (parseInt(id)) {
          case 1:
            return "A";
          case 2:
            return "B";
          case 3:
            return "C";
          case 4:
            return "D";
          default:
            return "";
        }
      }
      function verifyPasswordId(serviceId) {
        switch (parseInt(serviceId)) {
          case 1:
            counterServicesObject.password1Id =
              counterServicesObject.password1Id &&
              counterServicesObject.password1Id < getTotalServiceByid(1)
                ? counterServicesObject.password1Id + 1
                : 1;
            setData(serviceId);
            break;
          case 2:
            counterServicesObject.password2Id =
              counterServicesObject.password2Id &&
              counterServicesObject.password2Id < getTotalServiceByid(2)
                ? counterServicesObject.password2Id + 1
                : 1;
            setData(serviceId);
            break;
          case 3:
            counterServicesObject.password3Id =
              counterServicesObject.password3Id &&
              counterServicesObject.password3Id < getTotalServiceByid(3)
                ? counterServicesObject.password3Id + 1
                : 1;
            setData(serviceId);
            break;
          case 4:
            counterServicesObject.password4Id =
              counterServicesObject.password4Id &&
              counterServicesObject.password4Id < getTotalServiceByid(4)
                ? counterServicesObject.password4Id + 1
                : 1;
            setData(serviceId);
            break;
          default:
            break;
        }
      }

      function verifyAndDisableSpeakBtnBytotal() {
        switch (parseInt(currentCall.serviceId)) {
          case 1:
            if (
              getTotalServiceByid(1) <= 0 ||
              getTotalServiceByid(1) === counterServicesObject.password1Id
            ) {
              document.getElementById("btnSpeak").disabled = true;
            } else {
              document.getElementById("btnSpeak").disabled = false;
            }
            break;
          case 2:
            if (
              getTotalServiceByid(2) <= 0 ||
              getTotalServiceByid(2) === counterServicesObject.password2Id
            ) {
              document.getElementById("btnSpeak").disabled = true;
            } else {
              document.getElementById("btnSpeak").disabled = false;
            }
            break;
          case 3:
            if (
              getTotalServiceByid(3) <= 0 ||
              getTotalServiceByid(3) === counterServicesObject.password3Id
            ) {
              document.getElementById("btnSpeak").disabled = true;
            } else {
              document.getElementById("btnSpeak").disabled = false;
            }
            break;
          case 4:
            if (
              getTotalServiceByid(4) <= 0 ||
              getTotalServiceByid(4) === counterServicesObject.password4Id
            ) {
              document.getElementById("btnSpeak").disabled = true;
            } else {
              document.getElementById("btnSpeak").disabled = false;
            }
            break;
          default:
            return 0;
        }
      }
    </script>
  </body>
</html>
